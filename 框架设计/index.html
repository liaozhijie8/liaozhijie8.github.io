<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>框架设计 - 6eon | 博客</title><meta name="Description" content="今天不学习,明天变废物"><meta property="og:title" content="框架设计" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://liaozhijie8.github.io/%E6%A1%86%E6%9E%B6%E8%AE%BE%E8%AE%A1/" /><meta property="og:image" content="https://liaozhijie8.github.io/tea.svg"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-31T18:21:48+08:00" />
<meta property="article:modified_time" content="2023-01-31T18:21:48+08:00" /><meta property="og:site_name" content="我的网站" />


<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://liaozhijie8.github.io/tea.svg"/>

<meta name="twitter:title" content="框架设计"/>
<meta name="twitter:description" content=""/>
<meta name="application-name" content="6eon | 博客">
<meta name="apple-mobile-web-app-title" content="6eon | 博客"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="canonical" href="https://liaozhijie8.github.io/%E6%A1%86%E6%9E%B6%E8%AE%BE%E8%AE%A1/" /><link rel="prev" href="https://liaozhijie8.github.io/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "框架设计",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/liaozhijie8.github.io\/%E6%A1%86%E6%9E%B6%E8%AE%BE%E8%AE%A1\/"
        },"genre": "posts","keywords": "","wordcount":  7307 ,
        "url": "https:\/\/liaozhijie8.github.io\/%E6%A1%86%E6%9E%B6%E8%AE%BE%E8%AE%A1\/","datePublished": "2023-01-31T18:21:48+08:00","dateModified": "2023-01-31T18:21:48+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "6eon"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="6eon | 博客"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/loop.svg"
        data-srcset="/loop.svg, /loop.svg 1.5x, /loop.svg 2x"
        data-sizes="auto"
        alt="/loop.svg"
        title="/loop.svg" /><span id="id-1" class="typeit"></span><span class="header-title-post"><i class="fab fa-gulp"></i></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/about/"> 关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="6eon | 博客"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/loop.svg"
        data-srcset="/loop.svg, /loop.svg 1.5x, /loop.svg 2x"
        data-sizes="auto"
        alt="/loop.svg"
        title="/loop.svg" /><span id="id-2" class="typeit"></span><span class="header-title-post"><i class="fab fa-gulp"></i></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/about/" title="">关于</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">框架设计</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>6eon</a></span>&nbsp;<span class="post-category">included in <a href="/categories/vue/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Vue</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2023-01-31">2023-01-31</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;7307 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;15 minutes&nbsp;<span id="/%E6%A1%86%E6%9E%B6%E8%AE%BE%E8%AE%A1/" class="leancloud_visitors" data-flag-title="框架设计">
                        <i class="far fa-eye fa-fw" aria-hidden="true"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;views
                    </span>&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#基本概念">基本概念</a>
          <ul>
            <li><a href="#vuejs">Vue.js</a></li>
          </ul>
        </li>
        <li><a href="#权衡的艺术">权衡的艺术</a>
          <ul>
            <li><a href="#声明式与命令式编程">声明式与命令式编程</a></li>
            <li><a href="#性能与可维护性的权衡">性能与可维护性的权衡</a></li>
            <li><a href="#虚拟dom">虚拟DOM</a></li>
            <li><a href="#运行时和编译时">运行时和编译时</a>
              <ul>
                <li><a href="#运行时">运行时</a></li>
                <li><a href="#编译时">编译时</a></li>
                <li><a href="#纯编译时">纯编译时</a></li>
                <li><a href="#总结">总结</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#vue渲染视图过程">Vue渲染视图过程</a>
          <ul>
            <li><a href="#vnode">VNode</a>
              <ul>
                <li><a href="#什么是vnode">什么是VNode</a></li>
                <li><a href="#vnode的作用">VNode的作用</a></li>
              </ul>
            </li>
            <li><a href="#patch">patch</a></li>
            <li><a href="#模板编译原理">模板编译原理</a>
              <ul>
                <li><a href="#解析器">解析器</a></li>
                <li><a href="#优化器">优化器</a></li>
                <li><a href="#代码生成器">代码生成器</a>
                  <ul>
                    <li><a href="#流程">流程</a></li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h3 id="基本概念">基本概念</h3>
<ul>
<li>
<p>在过去的10年时间里，网页变得更加动态化和强大了。通过JavaScript，我们已经可以把很多传统的服务端代码放到浏览器中。身为一名前端工程师，我们所面临的需求变得越来越复杂。当应用程序开始变复杂后，我们需要频繁操作DOM。由于缺乏正规的组织形式，我们的代码变得非常难以维护。这本质上是命令式操作DOM的问题，我们曾经用jQuery操作DOM写需求，但是当应用程序变复杂后，代码就像一坨意大利面一样，有点难以维护。我们无法继续使用命令式操作DOM，所以Vue.js提供了声明式操作DOM的能力来解决这个问题。</p>
</li>
<li>
<p>通过描述状态和DOM之间的映射关系，就可以将状态渲染成DOM呈现在用户界面中，也就是渲染到网页上。</p>
</li>
</ul>
<h4 id="vuejs">Vue.js</h4>
<ul>
<li>
<p>Vue允许你将一个网页分割成可复用的组件，每个组件都有自己的HTML、CSS和JavaScript来渲染网页中一个对应的位置。</p>
</li>
<li>
<p>如果要构建一个大型应用，就需要先搭建项目，配置一些开发环境等。Vue.js提供了一个命令行工具，它让快速初始化一个真实的项目工程变得非常简单。</p>
</li>
<li>
<p>我们甚至可以使用Vue.js的单文件组件，它包含各自的HTML、JavaScript以及带作用域的CSS或SCSS。单文件组件可以使项目架构变得非常清晰、可维护。</p>
</li>
</ul>
<p><strong>Vue</strong>定位为渐进式框架，把框架分层，最核心的部分是视图层渲染，往外是组件机制，路由机制，状态管理，最外层是构建工具。
<figure><img src="http://www.ituring.com.cn/figures/2020/Vuejs/01-001.png"/><figcaption>
            <h4>框架分层</h4>
        </figcaption>
</figure>
</p>
<ul>
<li>所谓分层，就是说你既可以只用最核心的视图层渲染功能来快速开发一些需求，也可以使用一整套全家桶来开发大型应用。Vue.js有足够的灵活性来适应不同的需求，所以你可以根据自己的需求选择不同的层级。</li>
</ul>
<h3 id="权衡的艺术">权衡的艺术</h3>
<h4 id="声明式与命令式编程">声明式与命令式编程</h4>
<p>从范式上来看，视图层框架通常分为命令式和声明式，它们各有优缺点。</p>
<ul>
<li>早年间流行的 jQuery 就是典型的命令式框架。命令式框架的一大特点就是关注过程。例如，我们把下面这段话翻译成对应的代码：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">01 - 获取 id 为 app 的 div 标签
</span></span><span class="line"><span class="cl">02 - 它的文本内容为 hello world
</span></span><span class="line"><span class="cl">03 - 为其绑定点击事件
</span></span><span class="line"><span class="cl">04 - 当点击时弹出提示：ok
</span></span></code></pre></td></tr></table>
</div>
</div><p>对应的代码:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="mi">01</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#app&#39;</span><span class="p">)</span> <span class="c1">// 获取 div
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">02</span>   <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;hello world&#39;</span><span class="p">)</span> <span class="c1">// 设置文本内容
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">03</span>   <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;ok&#39;</span><span class="p">)</span> <span class="p">})</span> <span class="c1">// 绑定点击事件
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>可以看到，自然语言描述能够与代码产生一一对应的关系，代码本身描述的是“做事的过程”，这符合我们的逻辑直觉。</li>
</ul>
<p>　　那么，什么是声明式框架呢？与命令式框架更加关注过程不同，声明式框架更加关注结果。结合 Vue.js，我们来看看如何实现上面自然语言描述的功能：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="mi">01</span> <span class="o">&lt;</span><span class="nx">div</span> <span class="err">@</span><span class="nx">click</span><span class="o">=</span><span class="s2">&#34;() =&gt; alert(&#39;ok&#39;)&#34;</span><span class="o">&gt;</span><span class="nx">hello</span> <span class="nx">world</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>这段类 HTML 的模板就是 Vue.js 实现如上功能的方式。可以看到，我们提供的是一个“结果”，至于如何实现这个“结果”，我们并不关心，Vue.js 的内部实现采用的是命令式的，而暴露给用户的是声明式。</li>
</ul>
<h4 id="性能与可维护性的权衡">性能与可维护性的权衡</h4>
<p>先说结论:<em><strong>声明式代码的性能不优于命令式代码的性能</strong></em>。</p>
<ul>
<li>假设我们要修改div中的文本,采用命令式可以这样直接修改，并且没有比这个更简单的方法了，</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="mi">01</span> <span class="nx">div</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="s1">&#39;hello vue3&#39;</span> <span class="c1">// 直接修改
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>可以看到，理论上命令式代码可以做到极致的性能优化，因为我们明确知道哪些发生了变更，只做必要的修改就行了。但是声明式代码不一定能做到这一点，因为它描述的是结果：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="mi">01</span> <span class="c">&lt;!--</span> <span class="nx">之前</span><span class="err">：</span> <span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="mi">02</span> <span class="o">&lt;</span><span class="nx">div</span> <span class="err">@</span><span class="nx">click</span><span class="o">=</span><span class="s2">&#34;() =&gt; alert(&#39;ok&#39;)&#34;</span><span class="o">&gt;</span><span class="nx">hello</span> <span class="nx">world</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span></span><span class="line"><span class="cl"><span class="mi">03</span> <span class="c">&lt;!--</span> <span class="nx">之后</span><span class="err">：</span> <span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="mi">04</span> <span class="o">&lt;</span><span class="nx">div</span> <span class="err">@</span><span class="nx">click</span><span class="o">=</span><span class="s2">&#34;() =&gt; alert(&#39;ok&#39;)&#34;</span><span class="o">&gt;</span><span class="nx">hello</span> <span class="nx">vue3</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>对于框架来说，为了实现最优的更新性能，它需要找到前后的差异并只更新变化的地方，但是最终完成这次更新的代码仍然是：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="mi">01</span> <span class="nx">div</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="s1">&#39;hello vue3&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>如果我们把直接修改的性能消耗定义为 A，把找出差异的性能消耗定义为 B，那么有：
命令式代码的更新性能消耗 = A
声明式代码的更新性能消耗 = B + A
　　可以看到，声明式代码会比命令式代码多出找出差异的性能消耗，因此最理想的情况是，当找出差异的性能消耗为 0 时，声明式代码与命令式代码的性能相同，但是无法做到超越，毕竟框架本身就是封装了命令式代码才实现了面向用户的声明式。这符合前文中给出的性能结论：声明式代码的性能不优于命令式代码的性能。</p>
</blockquote>
<p>　　既然在性能层面命令式代码是更好的选择，那么为什么 Vue.js 要选择声明式的设计方案呢？原因就在于声明式代码的可维护性更强。从上面例子的代码中我们也可以感受到，在采用命令式代码开发的时候，我们需要维护实现目标的整个过程，包括要手动完成 DOM 元素的创建、更新、删除等工作。而声明式代码展示的就是我们要的结果，看上去更加直观，至于做事儿的过程，并不需要我们关心，Vue.js 都为我们封装好了。</p>
<h4 id="虚拟dom">虚拟DOM</h4>
<p><em><strong>声明式代码的更新性能消耗 = 找出差异的性能消耗 + 直接修改的性能消耗</strong></em>，因此，如果我们能够最小化找出差异的性能消耗，就可以让声明式代码的性能无限接近命令式代码的性能。而所谓的虚拟 DOM，就是为了最小化找出差异这一步的性能消耗而出现的。
<strong>虚拟DOM通过状态生成一个虚拟节点树，然后使用虚拟节点树进行渲染。在渲染之前，会使用新生成的虚拟节点树和上一次生成的虚拟节点树进行对比，只渲染不同的部分。</strong></p>
<ul>
<li>虚拟节点树其实是由组件树建立起来的整个虚拟节点（Virtual Node，也经常简写为vnode）树。</li>
<li>虚拟DOM能够让我们不用付出太多的努力（写声明式代码），还能够保证应用程序的性能下限，让应用程序的性能不至于太差，甚至想办法逼近命令式代码的性能
<figure><img src="http://www.ituring.com.cn/figures/2022/Vuejsdesign/005.jpg"/><figcaption>
            <h4>innerHTML、虚拟 DOM 以及原生 JavaScript 在更新页面时的性能</h4>
        </figcaption>
</figure>
</li>
<li>原生 DOM 操作方法的心智负担最大，因为你要手动创建、删除、修改大量的 DOM 元素。但它的性能是最高的，不过为了使其性能最佳，我们同样要承受巨大的心智负担。另外，以这种方式编写的代码，可维护性也极差。而对于 innerHTML 来说，由于我们编写页面的过程有一部分是通过拼接 HTML 字符串来实现的，这有点儿接近声明式的意思，但是拼接字符串总归也是有一定心智负担的，而且对于事件绑定之类的事情，我们还是要使用原生 JavaScript 来处理。如果 innerHTML 模板很大，则其更新页面的性能最差，尤其是在只有少量更新时。最后，我们来看看虚拟 DOM，它是声明式的，因此心智负担小，可维护性强，性能虽然比不上极致优化的原生 JavaScript，但是在保证心智负担和可维护性的前提下相当不错。</li>
</ul>
<h4 id="运行时和编译时">运行时和编译时</h4>
<p>当设计一个框架的时候，我们有三种选择：纯运行时的、运行时 + 编译时的或纯编译时的。</p>
<h5 id="运行时">运行时</h5>
<ul>
<li>编写一个Render函数，用户可以为该函数提供一个树型结构的数据对象，然后使用Render函数，根据该对象递归地将数据渲染成 DOM 元素。</li>
<li>数据对象如下:</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="mi">01</span> <span class="kr">const</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="mi">02</span>   <span class="nx">tag</span><span class="o">:</span> <span class="s1">&#39;div&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="mi">03</span>   <span class="nx">children</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl"><span class="mi">04</span>     <span class="p">{</span> <span class="nx">tag</span><span class="o">:</span> <span class="s1">&#39;span&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span> <span class="s1">&#39;hello world&#39;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="mi">05</span>   <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="mi">06</span> <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Render函数</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="mi">01</span> <span class="kd">function</span> <span class="nx">Render</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="mi">02</span>   <span class="kr">const</span> <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">tag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">03</span>   <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">children</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="mi">04</span>     <span class="kr">const</span> <span class="nx">text</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">children</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">05</span>     <span class="nx">el</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">06</span>   <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">children</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="mi">07</span>     <span class="c1">// 数组，递归调用 Render，使用 el 作为 root 参数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">08</span>     <span class="nx">obj</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">child</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">Render</span><span class="p">(</span><span class="nx">child</span><span class="p">,</span> <span class="nx">el</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="mi">09</span>   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="mi">10</span>
</span></span><span class="line"><span class="cl"><span class="mi">11</span>   <span class="c1">// 将元素添加到 root
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">12</span>   <span class="nx">root</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">13</span> <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>把数据对象交给Render函数处理</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="mi">01</span> <span class="kr">const</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="mi">02</span>   <span class="nx">tag</span><span class="o">:</span> <span class="s1">&#39;div&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="mi">03</span>   <span class="nx">children</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl"><span class="mi">04</span>     <span class="p">{</span> <span class="nx">tag</span><span class="o">:</span> <span class="s1">&#39;span&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span> <span class="s1">&#39;hello world&#39;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="mi">05</span>   <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="mi">06</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="mi">07</span> <span class="c1">// 渲染到 body 下
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">08</span> <span class="nx">Render</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>用户在使用它渲染内容时，直接为 Render 函数提供了一个树型结构的数据对象。这里面不涉及任何额外的步骤，用户也不需要学习额外的知识。但是有一天，你的用户抱怨说：“手写树型结构的数据对象太麻烦了，而且不直观，能不能支持用类似于 HTML 标签的方式描述树型结构的数据对象呢？”你看了看现在的 Render 函数，然后回答：“抱歉，暂不支持。”</p>
</blockquote>
<h5 id="编译时">编译时</h5>
<p>为了解决<strong>纯运行时</strong>，编写树形结构对象的痛点，引入编译的手段，把 HTML 标签编译成树型结构的数据对象，从而可以继续使用 Render 函数</p>
<figure><img src="http://www.ituring.com.cn/figures/2022/Vuejsdesign/006.jpg"/><figcaption>
            <h4>把 HTML 标签编译成树型结构的数据对象</h4>
        </figcaption>
</figure>

<ul>
<li>Compiler程序的作用就是把 HTML 字符串编译成树型结构的数据对象，让用户分别调用 Compiler 函数和 Render 函数：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="mi">01</span> <span class="kr">const</span> <span class="nx">html</span> <span class="o">=</span> <span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">02 &lt;div&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">03   &lt;span&gt;hello world&lt;/span&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">04 &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">05 `</span>
</span></span><span class="line"><span class="cl"><span class="mi">06</span> <span class="c1">// 调用 Compiler 编译得到树型结构的数据对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">07</span> <span class="kr">const</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nx">Compiler</span><span class="p">(</span><span class="nx">html</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">08</span> <span class="c1">// 再调用 Render 进行渲染
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">09</span> <span class="nx">Render</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>这是一个运行时 + 编译时的框架雏形。它既支持运行时，用户可以直接提供数据对象从而无须编译；又支持编译时，用户可以提供 HTML 字符串，我们将其编译为数据对象后再交给运行时处理。准确地说，上面的代码其实是运行时编译，意思是代码运行的时候才开始编译，而这会产生一定的性能开销，因此我们也可以在构建的时候就执行 Compiler 程序将用户提供的内容编译好，等到运行时就无须编译了，这对性能是非常友好的。</li>
</ul>
<h5 id="纯编译时">纯编译时</h5>
<p>既然编译器可以把 HTML 字符串编译成数据对象，那么能不能直接编译成命令式代码呢？</p>
<figure><img src="http://www.ituring.com.cn/figures/2022/Vuejsdesign/007.jpg"/><figcaption>
            <h4>将 HTML 字符串编译为命令式代码的过程</h4>
        </figcaption>
</figure>

<ul>
<li>这样我们只需要一个 Compiler 函数就可以了，连 Render 都不需要了。其实这就变成了一个纯编译时的框架，因为我们不支持任何运行时内容，用户的代码通过编译器编译后才能运行。</li>
</ul>
<h5 id="总结">总结</h5>
<ul>
<li>纯运行时的框架。
由于它没有编译的过程，因此我们没办法分析用户提供的内容，但是如果加入编译步骤，可能就大不一样了，我们可以分析用户提供的内容，看看哪些内容未来可能会改变，哪些内容永远不会改变，这样我们就可以在编译的时候提取这些信息，然后将其传递给 Render 函数，Render 函数得到这些信息之后，就可以做进一步的优化了。</li>
<li>纯编译时的框架
也可以分析用户提供的内容。由于不需要任何运行时，而是直接编译成可执行的 JavaScript 代码，因此性能可能会更好，但是这种做法有损灵活性，即用户提供的内容必须编译后才能用。</li>
</ul>
<p>实际上，在这三个方向上业内都有探索，其中 Svelte 就是纯编译时的框架，但是它的真实性能可能达不到理论高度。Vue.js 3 仍然保持了运行时 + 编译时的架构，在保持灵活性的基础上能够尽可能地去优化。等到后面讲解 Vue.js 3 的编译优化相关内容时，你会看到 Vue.js 3 在保留运行时的情况下，其性能甚至不输纯编译时的框架。</p>
<h3 id="vue渲染视图过程">Vue渲染视图过程</h3>
<ul>
<li>
<p>在Vue.js中，我们使用模板来描述状态与DOM之间的映射关系。Vue.js通过编译将模板转换成渲染函数（render），执行渲染函数就可以得到一个虚拟节点树，使用这个虚拟节点树就可以渲染页面，
<figure><img src="http://www.ituring.com.cn/figures/2020/Vuejs/05-004.png"/><figcaption>
            <h4>模板转换成视图的过程</h4>
        </figcaption>
</figure>
</p>
</li>
<li>
<p>虚拟DOM的终极目标是将虚拟节点（vnode）渲染到视图上。但是如果直接使用虚拟节点覆盖旧节点的话，会有很多不必要的DOM操作。</p>
</li>
<li>
<p>为了避免不必要的DOM操作，虚拟DOM在虚拟节点映射到视图的过程中，将虚拟节点与上一次渲染视图所使用的旧虚拟节点（oldVnode）做对比，找出真正需要更新的节点来进行DOM操作，从而避免操作其他无任何改动的DOM。
<figure><img src="http://www.ituring.com.cn/figures/2020/Vuejs/05-005.png"/><figcaption>
            <h4>虚拟DOM的执行过程</h4>
        </figcaption>
</figure>
</p>
</li>
</ul>
<blockquote>
<p>1）提供与真实DOM节点所对应的虚拟节点vnode。
2）将虚拟节点vnode和旧虚拟节点oldVnode进行比对，然后更新视图。</p>
</blockquote>
<h4 id="vnode">VNode</h4>
<h5 id="什么是vnode">什么是VNode</h5>
<p>它是Vue.js中存在的一个类，使用它可以实例化不同类型的vnode实例，而不同类型的vnode实例各自表示不同类型的DOM元素。</p>
<p>例如，DOM元素有元素节点、文本节点和注释节点等，vnode实例也会对应着有元素节点、文本节点和注释节点等。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="mi">01</span>  <span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VNode</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="mi">02</span>    <span class="nx">constructor</span> <span class="p">(</span><span class="nx">tag</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">children</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">elm</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">componentOptions</span><span class="p">,</span> <span class="nx">asyncFactory</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="mi">03</span>      <span class="k">this</span><span class="p">.</span><span class="nx">tag</span> <span class="o">=</span> <span class="nx">tag</span>
</span></span><span class="line"><span class="cl"><span class="mi">04</span>      <span class="k">this</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">data</span>
</span></span><span class="line"><span class="cl"><span class="mi">05</span>      <span class="k">this</span><span class="p">.</span><span class="nx">children</span> <span class="o">=</span> <span class="nx">children</span>
</span></span><span class="line"><span class="cl"><span class="mi">06</span>      <span class="k">this</span><span class="p">.</span><span class="nx">text</span> <span class="o">=</span> <span class="nx">text</span>
</span></span><span class="line"><span class="cl"><span class="mi">07</span>      <span class="k">this</span><span class="p">.</span><span class="nx">elm</span> <span class="o">=</span> <span class="nx">elm</span>
</span></span><span class="line"><span class="cl"><span class="mi">08</span>      <span class="k">this</span><span class="p">.</span><span class="nx">ns</span> <span class="o">=</span> <span class="kc">undefined</span>
</span></span><span class="line"><span class="cl"><span class="mi">09</span>      <span class="k">this</span><span class="p">.</span><span class="nx">context</span> <span class="o">=</span> <span class="nx">context</span>
</span></span><span class="line"><span class="cl"><span class="mi">10</span>      <span class="k">this</span><span class="p">.</span><span class="nx">functionalContext</span> <span class="o">=</span> <span class="kc">undefined</span>
</span></span><span class="line"><span class="cl"><span class="mi">11</span>      <span class="k">this</span><span class="p">.</span><span class="nx">functionalOptions</span> <span class="o">=</span> <span class="kc">undefined</span>
</span></span><span class="line"><span class="cl"><span class="mi">12</span>      <span class="k">this</span><span class="p">.</span><span class="nx">functionalScopeId</span> <span class="o">=</span> <span class="kc">undefined</span>
</span></span><span class="line"><span class="cl"><span class="mi">13</span>      <span class="k">this</span><span class="p">.</span><span class="nx">key</span> <span class="o">=</span> <span class="nx">data</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">key</span>
</span></span><span class="line"><span class="cl"><span class="mi">14</span>      <span class="k">this</span><span class="p">.</span><span class="nx">componentOptions</span> <span class="o">=</span> <span class="nx">componentOptions</span>
</span></span><span class="line"><span class="cl"><span class="mi">15</span>      <span class="k">this</span><span class="p">.</span><span class="nx">componentInstance</span> <span class="o">=</span> <span class="kc">undefined</span>
</span></span><span class="line"><span class="cl"><span class="mi">16</span>      <span class="k">this</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="kc">undefined</span>
</span></span><span class="line"><span class="cl"><span class="mi">17</span>      <span class="k">this</span><span class="p">.</span><span class="nx">raw</span> <span class="o">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl"><span class="mi">18</span>      <span class="k">this</span><span class="p">.</span><span class="nx">isStatic</span> <span class="o">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl"><span class="mi">19</span>      <span class="k">this</span><span class="p">.</span><span class="nx">isRootInsert</span> <span class="o">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl"><span class="mi">20</span>      <span class="k">this</span><span class="p">.</span><span class="nx">isComment</span> <span class="o">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl"><span class="mi">21</span>      <span class="k">this</span><span class="p">.</span><span class="nx">isCloned</span> <span class="o">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl"><span class="mi">22</span>      <span class="k">this</span><span class="p">.</span><span class="nx">isOnce</span> <span class="o">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl"><span class="mi">23</span>      <span class="k">this</span><span class="p">.</span><span class="nx">asyncFactory</span> <span class="o">=</span> <span class="nx">asyncFactory</span>
</span></span><span class="line"><span class="cl"><span class="mi">24</span>      <span class="k">this</span><span class="p">.</span><span class="nx">asyncMeta</span> <span class="o">=</span> <span class="kc">undefined</span>
</span></span><span class="line"><span class="cl"><span class="mi">25</span>      <span class="k">this</span><span class="p">.</span><span class="nx">isAsyncPlaceholder</span> <span class="o">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl"><span class="mi">26</span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="mi">27</span>  
</span></span><span class="line"><span class="cl"><span class="mi">28</span>    <span class="nx">get</span> <span class="nx">child</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="mi">29</span>      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">componentInstance</span>
</span></span><span class="line"><span class="cl"><span class="mi">30</span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="mi">31</span>  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>vnode可以理解成节点描述对象，它描述了应该怎样去创建真实的DOM节点。
vnode表示一个真实的DOM元素，所有真实的DOM节点都使用vnode创建并插入到页面中:<strong>渲染视图的过程是先创建vnode，然后再使用vnode去生成真实的DOM元素，最后插入到页面渲染视图。</strong>
<figure><img src="http://www.ituring.com.cn/figures/2020/Vuejs/06-001.png"/><figcaption>
            <h4>VNode创建DOM并插入到视图</h4>
        </figcaption>
</figure>
</p>
<h5 id="vnode的作用">VNode的作用</h5>
<ul>
<li>由于每次渲染视图时都是先创建vnode，然后使用它创建真实DOM插入到页面中，所以可以将上一次渲染视图时所创建的vnode缓存起来，之后每当需要重新渲染视图时，将新创建的vnode和上一次缓存的vnode进行对比，查看它们之间有哪些不一样的地方，找出这些不一样的地方并基于此去修改真实的DOM。</li>
<li>
<ul>
<li>Vue.js目前对状态的侦测策略采用了中等粒度。当状态发生变化时，只通知到组件级别，然后组件内使用虚拟DOM来渲染视图。
也就是说，只要组件使用的众多状态中有一个发生了变化，那么整个组件就要重新渲染。</li>
</ul>
</li>
</ul>
<p>如果组件只有一个节点发生了变化，那么重新渲染整个组件的所有节点，很明显会造成很大的性能浪费。因此，对vnode进行缓存，并将上一次缓存的vnode和当前新创建的vnode进行对比，只更新发生变化的节点就变得尤为重要。这也是vnode最重要的一个作用。</p>
<h4 id="patch">patch</h4>
<ul>
<li>它虚拟DOM最核心的部分，可以将vnode渲染成真实的DOM。</li>
</ul>
<p>patch也可以叫作patching算法，通过它渲染真实DOM时，并不是暴力覆盖原有DOM，而是比对新旧两个vnode之间有哪些不同，然后根据对比结果找出需要更新的节点进行更新。这一点从名字就可以看出，patch本身就有补丁、修补等意思，其实际作用是在现有DOM上进行修改来实现更新视图的目的。</p>
<p>之所以要这么做，主要是因为DOM操作的执行速度远不如JavaScript的运算速度快。因此，把大量的DOM操作搬运到JavaScript中，使用patching算法来计算出真正需要更新的节点，最大限度地减少DOM操作，从而显著提升性能。这本质上其实是使用JavaScript的运算成本来替换DOM操作的执行成本，而JavaScript的运算速度要比DOM快很多，这样做很划算，所以才会有虚拟DOM。</p>
<ul>
<li>创建新增的节点；</li>
<li>删除已经废弃的节点；</li>
<li>修改需要更新的节点。</li>
</ul>
<h4 id="模板编译原理">模板编译原理</h4>
<ul>
<li>
<p>模板编译成渲染函数有三部分内容：先将模板解析成AST，然后遍历AST标记静态节点，最后使用AST生成代码字符串。这三部分内容分别对应三个模块：解析器、优化器和代码生成器。
<figure><img src="http://www.ituring.com.cn/figures/2020/Vuejs/08-001.png"/><figcaption>
            <h4>模板编译在整个渲染过程中的位置</h4>
        </figcaption>
</figure>
</p>
</li>
<li>
<p>Vue.js提供了模板语法，允许我们声明式地描述状态和DOM之间的绑定关系，然后通过模板来生成真实DOM并将其呈现在用户界面上。</p>
</li>
<li>
<p>在底层实现上，Vue.js会将模板编译成虚拟DOM渲染函数。当应用内部的状态发生变化时，Vue.js可以结合响应式系统，聪明地找出最小数量的组件进行重新渲染以及最少量地进行DOM操作</p>
</li>
</ul>
<h5 id="解析器">解析器</h5>
<blockquote>
<p>解析器的作用是通过模板得到AST（抽象语法树）。
生成AST的过程需要借助HTML解析器，当HTML解析器触发不同的钩子函数时，我们可以构建出不同的节点。随后，我们可以通过栈来得到当前正在构建的节点的父节点，然后将构建出的节点添加到父节点的下面。最终，当HTML解析器运行完毕后，我们就可以得到一个完整的带DOM层级关系的AST。HTML解析器的内部原理是一小段一小段地截取模板字符串，每截取一小段字符串，就会根据截取出来的字符串类型触发不同的钩子函数，直到模板字符串截空停止运行。文本分两种类型，不带变量的纯文本和带变量的文本，后者需要使用文本解析器进行二次加工。</p>
</blockquote>
<ul>
<li>解析器内部也分了好几个子解析器，比如HTML解析器、文本解析器以及过滤器解析器，其中最主要的是HTML解析器</li>
</ul>
<p>模板:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="mi">01</span>  <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="mi">02</span>    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">{{</span><span class="nx">name</span><span class="p">}}</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span></span><span class="line"><span class="cl"><span class="mi">03</span>  <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>转换成AST后：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="mi">01</span>  <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="mi">02</span>    <span class="nx">tag</span><span class="o">:</span> <span class="s2">&#34;div&#34;</span>
</span></span><span class="line"><span class="cl"><span class="mi">03</span>    <span class="nx">type</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="mi">04</span>    <span class="nx">staticRoot</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="mi">05</span>    <span class="kr">static</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="mi">06</span>    <span class="nx">plain</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="mi">07</span>    <span class="nx">parent</span><span class="o">:</span> <span class="kc">undefined</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="mi">08</span>    <span class="nx">attrsList</span><span class="o">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl"><span class="mi">09</span>    <span class="nx">attrsMap</span><span class="o">:</span> <span class="p">{},</span>
</span></span><span class="line"><span class="cl"><span class="mi">10</span>    <span class="nx">children</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl"><span class="mi">11</span>      <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="mi">12</span>        <span class="nx">tag</span><span class="o">:</span> <span class="s2">&#34;p&#34;</span>
</span></span><span class="line"><span class="cl"><span class="mi">13</span>        <span class="nx">type</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="mi">14</span>        <span class="nx">staticRoot</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="mi">15</span>        <span class="kr">static</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="mi">16</span>        <span class="nx">plain</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="mi">17</span>        <span class="nx">parent</span><span class="o">:</span> <span class="p">{</span><span class="nx">tag</span><span class="o">:</span> <span class="s2">&#34;div&#34;</span><span class="p">,</span> <span class="p">...},</span>
</span></span><span class="line"><span class="cl"><span class="mi">18</span>        <span class="nx">attrsList</span><span class="o">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl"><span class="mi">19</span>        <span class="nx">attrsMap</span><span class="o">:</span> <span class="p">{},</span>
</span></span><span class="line"><span class="cl"><span class="mi">20</span>        <span class="nx">children</span><span class="o">:</span> <span class="p">[{</span>
</span></span><span class="line"><span class="cl"><span class="mi">21</span>          <span class="nx">type</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="mi">22</span>          <span class="nx">text</span><span class="o">:</span> <span class="s2">&#34;{{name}}&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="mi">23</span>          <span class="kr">static</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="mi">24</span>          <span class="nx">expression</span><span class="o">:</span> <span class="s2">&#34;_s(name)&#34;</span>
</span></span><span class="line"><span class="cl"><span class="mi">25</span>        <span class="p">}]</span>
</span></span><span class="line"><span class="cl"><span class="mi">26</span>      <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="mi">27</span>    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="mi">28</span>  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>AST是用JavaScript中的对象来描述一个节点，一个对象表示一个节点，对象中的属性用来保存节点所需的各种数据。比如，parent属性保存了父节点的描述对象，children属性是一个数组，里面保存了一些子节点的描述对象。再比如，type属性表示一个节点的类型等。当很多个独立的节点通过parent属性和children属性连在一起时，就变成了一个树，而这样一个用对象描述的节点树其实就是AST。</li>
</ul>
<h5 id="优化器">优化器</h5>
<p>优化器的作用是在AST中找出静态子树并打上标记，这样做有两个好处：</p>
<p>每次重新渲染时，不需要为静态子树创建新节点；
在虚拟DOM中打补丁的过程可以跳过。
优化器的内部实现其实主要分为两个步骤：</p>
<p>(1) 在AST中找出所有静态节点并打上标记；</p>
<p>(2) 在AST中找出所有静态根节点并打上标记。</p>
<p>通过递归的方式从上向下标记静态节点时，如果一个节点被标记为静态节点，但它的子节点却被标记为动态节点，就说明该节点不是静态节点，可以将它改为动态节点。静态节点的特征是它的子节点必须是静态节点。</p>
<p>标记完静态节点之后需要标记静态根节点，其标记方式也是使用递归的方式从上向下寻找，在寻找的过程中遇到的第一个静态节点就为静态根节点，同时不再向下继续查找。</p>
<p>但有两种情况比较特殊：一种是如果一个静态根节点的子节点只有一个文本节点，那么不会将它标记成静态根节点，即便它也属于静态根节点；另一种是如果找到的静态根节点是一个没有子节点的静态节点，那么也不会将它标记为静态根节点。因为这两种情况下，优化成本大于收益。</p>
<h5 id="代码生成器">代码生成器</h5>
<blockquote>
<p>代码生成器是模板编译的最后一步，它的作用是将AST转换成渲染函数中的内容，这个内容可以称为代码字符串。代码字符串可以被包装在函数中执行，这个函数就是我们通常所说的渲染函数。<strong>渲染函数被执行之后，可以生成一份VNode，而虚拟DOM可以通过这个VNode来渲染视图</strong></p>
</blockquote>
<h6 id="流程">流程</h6>
<p>1、模板:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="mi">01</span>  <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;el&#34;</span><span class="o">&gt;</span><span class="nx">Hello</span> <span class="p">{{</span><span class="nx">name</span><span class="p">}}</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>2、转换成AST并且经过优化器的优化后:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="mi">01</span>  <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="mi">02</span>    <span class="s1">&#39;type&#39;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="mi">03</span>    <span class="s1">&#39;tag&#39;</span><span class="o">:</span> <span class="s1">&#39;div&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="mi">04</span>    <span class="s1">&#39;attrsList&#39;</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl"><span class="mi">05</span>      <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="mi">06</span>        <span class="s1">&#39;name&#39;</span><span class="o">:</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="mi">07</span>        <span class="s1">&#39;value&#39;</span><span class="o">:</span> <span class="s1">&#39;el&#39;</span>
</span></span><span class="line"><span class="cl"><span class="mi">08</span>      <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="mi">09</span>    <span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="mi">10</span>    <span class="s1">&#39;attrsMap&#39;</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="mi">11</span>      <span class="s1">&#39;id&#39;</span><span class="o">:</span> <span class="s1">&#39;el&#39;</span>
</span></span><span class="line"><span class="cl"><span class="mi">12</span>    <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="mi">13</span>    <span class="s1">&#39;children&#39;</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl"><span class="mi">14</span>      <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="mi">15</span>        <span class="s1">&#39;type&#39;</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="mi">16</span>        <span class="s1">&#39;expression&#39;</span><span class="o">:</span> <span class="s1">&#39;&#34;Hello &#34;+_s(name)&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="mi">17</span>        <span class="s1">&#39;text&#39;</span><span class="o">:</span> <span class="s1">&#39;Hello {{name}}&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="mi">18</span>        <span class="s1">&#39;static&#39;</span><span class="o">:</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl"><span class="mi">19</span>      <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="mi">20</span>    <span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="mi">21</span>    <span class="s1">&#39;plain&#39;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="mi">22</span>    <span class="s1">&#39;attrs&#39;</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl"><span class="mi">23</span>      <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="mi">24</span>        <span class="s1">&#39;name&#39;</span><span class="o">:</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="mi">25</span>        <span class="s1">&#39;value&#39;</span><span class="o">:</span> <span class="s1">&#39;&#34;el&#34;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="mi">26</span>      <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="mi">27</span>    <span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="mi">28</span>    <span class="s1">&#39;static&#39;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="mi">29</span>    <span class="s1">&#39;staticRoot&#39;</span><span class="o">:</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl"><span class="mi">30</span>  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>3、代码生成器可以通过上面这个AST来生成代码字符串：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"> <span class="s1">&#39;with(this){return _c(&#34;div&#34;,{attrs:{&#34;id&#34;:&#34;el&#34;}},[_v(&#34;Hello &#34;+_s(name))])}&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>格式化后:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="mi">01</span>  <span class="kd">with</span> <span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="mi">02</span>    <span class="k">return</span> <span class="nx">_c</span><span class="p">(</span>
</span></span><span class="line"><span class="cl"><span class="mi">03</span>      <span class="s2">&#34;div&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="mi">04</span>      <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="mi">05</span>        <span class="nx">attrs</span><span class="o">:</span><span class="p">{</span><span class="s2">&#34;id&#34;</span><span class="o">:</span> <span class="s2">&#34;el&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="mi">06</span>      <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="mi">07</span>      <span class="p">[</span>
</span></span><span class="line"><span class="cl"><span class="mi">08</span>        <span class="nx">_v</span><span class="p">(</span><span class="s2">&#34;Hello &#34;</span><span class="o">+</span><span class="nx">_s</span><span class="p">(</span><span class="nx">name</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="mi">09</span>      <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="mi">10</span>    <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">11</span>  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>仔细观察生成后的代码字符串，我们会发现，这其实是一个嵌套的函数调用。函数 _c的参数中执行了函数 _v，而函数 _v的参数中又执行了函数 _s。</p>
<p>代码字符串中的 _c其实是createElement的别名。createElement是虚拟DOM中所提供的方法，它的作用是创建虚拟节点，有三个参数，分别是：</p>
<p>标签名
一个包含模板相关属性的数据对象
子节点列表
调用createElement方法，我们可以得到一个VNode。</p>
<p>这也就知道了渲染函数可以生成VNode的原因：渲染函数其实是执行了createElement，而createElement可以创建一个VNode。</p></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2023-01-31</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/">Tags</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" class="prev" rel="prev" title="前端性能优化"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>前端性能优化</a></div>
</div>
<div id="comments"><div id="valine" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://valine.js.org/">Valine</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2019 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">6eon</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/valine/valine.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/valine/Valine.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/typeit/index.umd.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/mhchem.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{"valine":{"appId":"S04wKJkecyThUdEKgbRCgbBd-gzGzoHsz","appKey":"MvgrYSGOcg06cgKgxM7nmemd","avatar":"mp","el":"#valine","emojiCDN":"https://cdn.jsdelivr.net/npm/emoji-datasource-apple@14.0.0/img/apple/64/","emojiMaps":{"100":"1f4af.png","alien":"1f47d.png","anger":"1f4a2.png","angry":"1f620.png","anguished":"1f627.png","astonished":"1f632.png","black_heart":"1f5a4.png","blue_heart":"1f499.png","blush":"1f60a.png","bomb":"1f4a3.png","boom":"1f4a5.png","broken_heart":"1f494.png","brown_heart":"1f90e.png","clown_face":"1f921.png","cold_face":"1f976.png","cold_sweat":"1f630.png","confounded":"1f616.png","confused":"1f615.png","cry":"1f622.png","crying_cat_face":"1f63f.png","cupid":"1f498.png","dash":"1f4a8.png","disappointed":"1f61e.png","disappointed_relieved":"1f625.png","dizzy":"1f4ab.png","dizzy_face":"1f635.png","drooling_face":"1f924.png","exploding_head":"1f92f.png","expressionless":"1f611.png","face_vomiting":"1f92e.png","face_with_cowboy_hat":"1f920.png","face_with_hand_over_mouth":"1f92d.png","face_with_head_bandage":"1f915.png","face_with_monocle":"1f9d0.png","face_with_raised_eyebrow":"1f928.png","face_with_rolling_eyes":"1f644.png","face_with_symbols_on_mouth":"1f92c.png","face_with_thermometer":"1f912.png","fearful":"1f628.png","flushed":"1f633.png","frowning":"1f626.png","ghost":"1f47b.png","gift_heart":"1f49d.png","green_heart":"1f49a.png","grimacing":"1f62c.png","grin":"1f601.png","grinning":"1f600.png","hankey":"1f4a9.png","hear_no_evil":"1f649.png","heart":"2764-fe0f.png","heart_decoration":"1f49f.png","heart_eyes":"1f60d.png","heart_eyes_cat":"1f63b.png","heartbeat":"1f493.png","heartpulse":"1f497.png","heavy_heart_exclamation_mark_ornament":"2763-fe0f.png","hole":"1f573-fe0f.png","hot_face":"1f975.png","hugging_face":"1f917.png","hushed":"1f62f.png","imp":"1f47f.png","innocent":"1f607.png","japanese_goblin":"1f47a.png","japanese_ogre":"1f479.png","joy":"1f602.png","joy_cat":"1f639.png","kiss":"1f48b.png","kissing":"1f617.png","kissing_cat":"1f63d.png","kissing_closed_eyes":"1f61a.png","kissing_heart":"1f618.png","kissing_smiling_eyes":"1f619.png","laughing":"1f606.png","left_speech_bubble":"1f5e8-fe0f.png","love_letter":"1f48c.png","lying_face":"1f925.png","mask":"1f637.png","money_mouth_face":"1f911.png","nauseated_face":"1f922.png","nerd_face":"1f913.png","neutral_face":"1f610.png","no_mouth":"1f636.png","open_mouth":"1f62e.png","orange_heart":"1f9e1.png","partying_face":"1f973.png","pensive":"1f614.png","persevere":"1f623.png","pleading_face":"1f97a.png","pouting_cat":"1f63e.png","purple_heart":"1f49c.png","rage":"1f621.png","relaxed":"263a-fe0f.png","relieved":"1f60c.png","revolving_hearts":"1f49e.png","right_anger_bubble":"1f5ef-fe0f.png","robot_face":"1f916.png","rolling_on_the_floor_laughing":"1f923.png","scream":"1f631.png","scream_cat":"1f640.png","see_no_evil":"1f648.png","shushing_face":"1f92b.png","skull":"1f480.png","skull_and_crossbones":"2620-fe0f.png","sleeping":"1f634.png","sleepy":"1f62a.png","slightly_frowning_face":"1f641.png","slightly_smiling_face":"1f642.png","smile":"1f604.png","smile_cat":"1f638.png","smiley":"1f603.png","smiley_cat":"1f63a.png","smiling_face_with_3_hearts":"1f970.png","smiling_imp":"1f608.png","smirk":"1f60f.png","smirk_cat":"1f63c.png","sneezing_face":"1f927.png","sob":"1f62d.png","space_invader":"1f47e.png","sparkling_heart":"1f496.png","speak_no_evil":"1f64a.png","speech_balloon":"1f4ac.png","star-struck":"1f929.png","stuck_out_tongue":"1f61b.png","stuck_out_tongue_closed_eyes":"1f61d.png","stuck_out_tongue_winking_eye":"1f61c.png","sunglasses":"1f60e.png","sweat":"1f613.png","sweat_drops":"1f4a6.png","sweat_smile":"1f605.png","thinking_face":"1f914.png","thought_balloon":"1f4ad.png","tired_face":"1f62b.png","triumph":"1f624.png","two_hearts":"1f495.png","unamused":"1f612.png","upside_down_face":"1f643.png","weary":"1f629.png","white_frowning_face":"2639-fe0f.png","white_heart":"1f90d.png","wink":"1f609.png","woozy_face":"1f974.png","worried":"1f61f.png","yawning_face":"1f971.png","yellow_heart":"1f49b.png","yum":"1f60b.png","zany_face":"1f92a.png","zipper_mouth_face":"1f910.png","zzz":"1f4a4.png"},"enableQQ":true,"highlight":true,"lang":"en","pageSize":10,"placeholder":"说点什么？","recordIP":true,"visitor":true}},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"data":{"id-1":"6eon's Blog","id-2":"6eon's Blog"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":50,"type":"lunr"},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
